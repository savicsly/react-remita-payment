import{jsxs as e,jsx as n}from"react/jsx-runtime";import{useState as t,useCallback as r,useEffect as o,useRef as a}from"react";var i=function(){return i=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},i.apply(this,arguments)};function c(e,n,t,r){return new(t||(t=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(i,c)}s((r=r.apply(e,n||[])).next())})}function s(e,n){var t,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(t=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=n.call(e,a)}catch(e){c=[6,e],r=0}finally{t=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}"function"==typeof SuppressedError&&SuppressedError;var u=function(e){return/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(e)},l=function(e){return/^(\+234|234|0)[789][01]\d{8}$/.test(e.replace(/\s+/g,""))},d=function(e){return e>0&&e<=1e7&&Number.isFinite(e)},m=function(e){return/^[a-zA-Z0-9-_]{6,50}$/.test(e)},p=function(e){return e.replace(/[<>]/g,"").replace(/[&]/g,"&amp;").replace(/['"]/g,"").trim()},f=function(e){var n=[];return e.amount&&d(e.amount)||n.push("Invalid amount. Amount must be a positive number and not exceed 10,000,000"),e.email&&u(e.email)||n.push("Invalid email address format"),(!e.firstName||e.firstName.trim().length<2)&&n.push("First name must be at least 2 characters long"),(!e.lastName||e.lastName.trim().length<2)&&n.push("Last name must be at least 2 characters long"),e.transactionId&&m(e.transactionId)||n.push("Invalid transaction ID. Must be 6-50 alphanumeric characters"),e.phoneNumber&&!l(e.phoneNumber)&&n.push("Invalid phone number format"),n},y=function(e){var n=[];return e.publicKey&&0!==e.publicKey.trim().length||n.push("Public key is required"),e.serviceTypeId&&0!==e.serviceTypeId.trim().length||n.push("Service type ID is required"),e.currency&&!["NGN","USD","GBP","EUR"].includes(e.currency)&&n.push("Invalid currency. Supported currencies: NGN, USD, GBP, EUR"),n},v=function(e){void 0===e&&(e="RMT");var n=Date.now().toString(36),t=Math.random().toString(36).substr(2,9);return"".concat(e,"_").concat(n,"_").concat(t).toUpperCase()},h=function(){return!0},b=function(e){if(!e||"object"!=typeof e)return{};var n=i({},e);if("string"==typeof n.email){var t=n.email.split("@"),r=t[0],o=t[1];n.email="".concat(r.charAt(0),"***@").concat(o)}return"string"==typeof n.phoneNumber&&(n.phoneNumber="***".concat(n.phoneNumber.slice(-4))),"string"==typeof n.publicKey&&(n.publicKey="".concat(n.publicKey.slice(0,4),"***").concat(n.publicKey.slice(-4))),n},g={demo:"https://remitademo.net/payment/v1/remita-pay-inline.bundle.js",live:"https://login.remita.net/payment/v1/remita-pay-inline.bundle.js"},w=function(e){var n=e.config,i=e.environment,u=void 0===i?"demo":i,l=e.onSuccess,d=e.onError,m=e.onClose,p=t(!1),v=p[0],h=p[1],b=t(null),w=b[0],N=b[1],E=t(!1),P=E[0],R=E[1],I=t(!1),S=I[0],A=I[1],j=r(function(e){S&&N(e)},[S]);o(function(){if("undefined"!=typeof window&&"undefined"!=typeof document){var e=setTimeout(function(){A(!0)},0);return function(){return clearTimeout(e)}}},[]),o(function(){if(S){var e=null,t=y(n);t.length>0&&(e="Configuration errors: ".concat(t.join(", "))),e&&j(e)}},[S,n,j]);var C=a(null);a([]);var L=r(function(){return new Promise(function(e,n){if("undefined"!=typeof window&&"undefined"!=typeof document)if(window.RmPaymentEngine&&P)e();else if(document&&document.body)try{var t=g[u],r=document.querySelector('script[src="'.concat(t,'"]'));if(r){if(r.hasAttribute("data-loaded")||window.RmPaymentEngine)return R(!0),void e();var o=function(){r.setAttribute("data-loaded","true"),R(!0),e(),i()},a=function(){j("Failed to load Remita payment script"),n(new Error("Failed to load Remita payment script")),i()},i=function(){r.removeEventListener("load",o),r.removeEventListener("error",a)};return r.addEventListener("load",o),void r.addEventListener("error",a)}var c=document.createElement("script");c.src=t,c.async=!0,c.defer=!0,c.id="remita-payment-script-".concat(u),c.onload=function(){c.setAttribute("data-loaded","true"),R(!0),C.current=c,e()},c.onerror=function(){j("Failed to load Remita payment script"),n(new Error("Failed to load Remita payment script"))},c.setAttribute("crossorigin","anonymous"),c.setAttribute("referrerpolicy","strict-origin-when-cross-origin"),c.setAttribute("data-remita","payment-script"),document.body.appendChild(c)}catch(e){console.error("RemitaPayment: Error loading script:",e),j("Failed to load Remita payment script"),n(new Error("Failed to load Remita payment script"))}else setTimeout(function(){L().then(e).catch(n)},50);else e()})},[u,P,j]);o(function(){return function(){C.current&&C.current.parentNode&&C.current.parentNode.removeChild(C.current)}},[]);var k=r(function(e){return c(void 0,void 0,void 0,function(){var t,r,o,a,i,c,u;return s(this,function(s){switch(s.label){case 0:if("undefined"==typeof window)return[2];s.label=1;case 1:if(s.trys.push([1,4,,5]),h(!0),j(null),(t=f(e)).length>0)throw new Error("Payment data errors: ".concat(t.join(", ")));return P?[3,3]:[4,L()];case 2:s.sent(),s.label=3;case 3:if(!window.RmPaymentEngine)throw new Error("Remita payment engine not available");return r={key:n.publicKey,processRrr:!0,transactionId:null!==(i=e.transactionId)&&void 0!==i?i:"",amount:e.amount,currency:n.currency||"NGN",customerId:e.email,firstName:e.firstName,lastName:e.lastName,email:e.email,phoneNumber:null!==(c=e.phoneNumber)&&void 0!==c?c:"",narration:e.narration||"Payment for ".concat(null!==(u=e.transactionId)&&void 0!==u?u:""),onSuccess:function(t){var r;h(!1);var o={status:"success",transactionId:null!==(r=e.transactionId)&&void 0!==r?r:"",paymentReference:t.paymentReference||t.transactionId,message:t.message||"Payment successful",amount:e.amount,currency:n.currency||"NGN",channel:t.channel,gatewayResponseCode:t.gatewayResponseCode,gatewayResponseMessage:t.gatewayResponseMessage};l(o)},onError:function(e){h(!1);var n={status:"error",message:e.message||"Payment failed",code:e.code,details:e};j(n.message),d(n)},onClose:function(){h(!1),m()}},window.RmPaymentEngine.init(r),window.RmPaymentEngine.showPaymentWidget(),[3,5];case 4:return o=s.sent(),a=o instanceof Error?o.message:"Unknown error occurred",j(a),h(!1),d({status:"error",message:a}),[3,5];case 5:return[2]}})})},[n,P,L,j,l,d,m,h]);return{initiatePayment:r(function(e){return c(void 0,void 0,void 0,function(){var t,r,o;return s(this,function(a){return"undefined"==typeof window?[2,Promise.resolve()]:(t=y(n)).length>0?(o="Configuration errors: ".concat(t.join(", ")),j(o),d({status:"error",message:o}),[2,Promise.resolve()]):(r=f(e)).length>0?(o="Payment data errors: ".concat(r.join(", ")),j(o),d({status:"error",message:o}),[2,Promise.resolve()]):[2,k(e)]})})},[n,k,d,j]),isLoading:v,error:w,isScriptLoaded:P}},N=function(r){var a=r.config,u=r.paymentData,l=r.environment,d=void 0===l?"demo":l,m=r.onSuccess,p=r.onError,f=r.onClose,y=r.disabled,h=void 0!==y&&y,b=r.className,g=void 0===b?"":b,N=r.children,E=t(!1),P=E[0],R=E[1];o(function(){"undefined"!=typeof window&&R(!0)},[]);var I=w({config:a,environment:d,onSuccess:m,onError:p,onClose:f}),S=I.initiatePayment,A=I.isLoading,j=I.error,C=I.isScriptLoaded,L=A?"Processing...":P&&C?N||"Pay Now":"Loading...",k=h||A||!C||!P||!!j;return e("div",{className:"remita-payment-container ".concat(g),children:[n("button",{type:"button",onClick:function(){return c(void 0,void 0,void 0,function(){var e;return s(this,function(n){switch(n.label){case 0:return h||A||!C||!P?[2]:(e=i(i({},u),{transactionId:u.transactionId||v()}),[4,S(e)]);case 1:return n.sent(),[2]}})})},disabled:k,className:"remita-payment-button","aria-label":"Initiate Remita payment",style:{cursor:k?"not-allowed":"pointer",opacity:k?.7:1},children:L}),j&&P&&n("div",{className:"remita-payment-error",role:"alert",children:e("span",{children:["Payment Error: ",j]})})]})};export{N as RemitaPayment,v as generateTransactionRef,b as maskSensitiveData,p as sanitizeString,w as useRemitaPayment,d as validateAmount,u as validateEmail,h as validateEnvironment,f as validatePaymentRequest,l as validatePhoneNumber,y as validateRemitaConfig,m as validateTransactionId};
//# sourceMappingURL=index.esm.js.map
