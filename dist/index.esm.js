import{jsxs as e,jsx as n}from"react/jsx-runtime";import{useState as r,useEffect as t,useRef as o,useCallback as a}from"react";var i=function(){return i=Object.assign||function(e){for(var n,r=1,t=arguments.length;r<t;r++)for(var o in n=arguments[r])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},i.apply(this,arguments)};function c(e,n,r,t){return new(r||(r=Promise))(function(o,a){function i(e){try{s(t.next(e))}catch(e){a(e)}}function c(e){try{s(t.throw(e))}catch(e){a(e)}}function s(e){var n;e.done?o(e.value):(n=e.value,n instanceof r?n:new r(function(e){e(n)})).then(i,c)}s((t=t.apply(e,n||[])).next())})}function s(e,n){var r,t,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(r=1,t&&(o=2&c[0]?t.return:c[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,c[1])).done)return o;switch(t=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,t=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=n.call(e,a)}catch(e){c=[6,e],t=0}finally{r=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}"function"==typeof SuppressedError&&SuppressedError;var u=function(e){return/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(e)},l=function(e){return/^(\+234|234|0)[789][01]\d{8}$/.test(e.replace(/\s+/g,""))},m=function(e){return e>0&&e<=1e7&&Number.isFinite(e)},p=function(e){return/^[a-zA-Z0-9-_]{6,50}$/.test(e)},d=function(e){return e.replace(/[<>]/g,"").replace(/[&]/g,"&amp;").replace(/['"]/g,"").trim()},f=function(e){var n=[];return e.amount&&m(e.amount)||n.push("Invalid amount. Amount must be a positive number and not exceed 10,000,000"),e.email&&u(e.email)||n.push("Invalid email address format"),(!e.firstName||e.firstName.trim().length<2)&&n.push("First name must be at least 2 characters long"),(!e.lastName||e.lastName.trim().length<2)&&n.push("Last name must be at least 2 characters long"),e.transactionId&&p(e.transactionId)||n.push("Invalid transaction ID. Must be 6-50 alphanumeric characters"),e.phoneNumber&&!l(e.phoneNumber)&&n.push("Invalid phone number format"),n},v=function(e){var n=[];return e.publicKey&&0!==e.publicKey.trim().length||n.push("Public key is required"),e.serviceTypeId&&0!==e.serviceTypeId.trim().length||n.push("Service type ID is required"),e.currency&&!["NGN","USD","GBP","EUR"].includes(e.currency)&&n.push("Invalid currency. Supported currencies: NGN, USD, GBP, EUR"),n},y=function(e){void 0===e&&(e="RMT");var n=Date.now().toString(36),r=Math.random().toString(36).substr(2,9);return"".concat(e,"_").concat(n,"_").concat(r).toUpperCase()},h=function(e){return void 0!==e&&("production"===process.env.NODE_ENV&&"https:"!==e.location.protocol&&console.warn("HTTPS is recommended for production payment processing"),!0)},g=function(e){if(!e||"object"!=typeof e)return{};var n=i({},e);if("string"==typeof n.email){var r=n.email.split("@"),t=r[0],o=r[1];n.email="".concat(t.charAt(0),"***@").concat(o)}return"string"==typeof n.phoneNumber&&(n.phoneNumber="***".concat(n.phoneNumber.slice(-4))),"string"==typeof n.publicKey&&(n.publicKey="".concat(n.publicKey.slice(0,4),"***").concat(n.publicKey.slice(-4))),n},b={demo:"https://remitademo.net/payment/v1/remita-pay-inline.bundle.js",live:"https://login.remita.net/payment/v1/remita-pay-inline.bundle.js"};function w(e){var n,r;return!!e&&"object"==typeof e&&"RmPaymentEngine"in e&&"function"==typeof(null===(n=e.RmPaymentEngine)||void 0===n?void 0:n.init)&&"function"==typeof(null===(r=e.RmPaymentEngine)||void 0===r?void 0:r.showPaymentWidget)}var N=function(e){var n=e.config,i=e.environment,u=void 0===i?"demo":i,l=e.onSuccess,m=e.onError,p=e.onClose,d=e.win,y=null;if(h(d)){var g=v(n);g.length>0&&(y="Configuration errors: ".concat(g.join(", ")))}else y="Invalid environment for payment processing";var N=r(!1),I=N[0],P=N[1],E=r(y),R=E[0],S=E[1],j=r(!1),C=j[0],A=j[1],k=function(e){S(e)};t(function(){var e=null;if(h(d)){var r=v(n);r.length>0&&(e="Configuration errors: ".concat(r.join(", ")))}else e="Invalid environment for payment processing";null===R&&null!==e&&k(e)},[d,n,R]);var x=o(null),z=o([]),L=a(function(){return new Promise(function(e,n){if(d&&w(d)&&C)e();else{if(!d)return k("Invalid environment for payment processing"),void n(new Error("Invalid environment for payment processing"));var r=d.document.querySelector('script[src="'.concat(b[u],'"]'));if(r)return r.addEventListener("load",function(){A(!0),e()}),void r.addEventListener("error",function(){k("Failed to load Remita payment script"),n(new Error("Failed to load Remita payment script"))});var t=d.document.createElement("script");t.src=b[u],t.async=!0,t.defer=!0,t.onload=function(){A(!0),x.current=t,e()},t.onerror=function(){k("Failed to load Remita payment script"),n(new Error("Failed to load Remita payment script"))},t.setAttribute("crossorigin","anonymous"),t.setAttribute("referrerpolicy","strict-origin-when-cross-origin"),d.document.body.appendChild(t)}})},[u,C,d]);t(function(){return function(){x.current&&x.current.parentNode&&x.current.parentNode.removeChild(x.current)}},[]);var Z=a(function(e){return c(void 0,void 0,void 0,function(){var r,t,o,a,i,c,u;return s(this,function(s){switch(s.label){case 0:if(!h(d))return k("Invalid environment for payment processing"),[2];s.label=1;case 1:if(s.trys.push([1,4,,5]),P(!0),k(null),z.current.length>0)throw new Error("Configuration errors: ".concat(z.current.join(", ")));if((r=f(e)).length>0)throw new Error("Payment data errors: ".concat(r.join(", ")));return C?[3,3]:[4,L()];case 2:s.sent(),s.label=3;case 3:if(!d||!w(d))throw new Error("Remita payment engine not available");return t={key:n.publicKey,processRrr:!0,transactionId:null!==(i=e.transactionId)&&void 0!==i?i:"",amount:e.amount,currency:n.currency||"NGN",customerId:e.email,firstName:e.firstName,lastName:e.lastName,email:e.email,phoneNumber:null!==(c=e.phoneNumber)&&void 0!==c?c:"",narration:e.narration||"Payment for ".concat(null!==(u=e.transactionId)&&void 0!==u?u:""),onSuccess:function(r){var t;P(!1);var o={status:"success",transactionId:null!==(t=e.transactionId)&&void 0!==t?t:"",paymentReference:r.paymentReference||r.transactionId,message:r.message||"Payment successful",amount:e.amount,currency:n.currency||"NGN",channel:r.channel,gatewayResponseCode:r.gatewayResponseCode,gatewayResponseMessage:r.gatewayResponseMessage};l(o)},onError:function(e){P(!1);var n={status:"error",message:e.message||"Payment failed",code:e.code,details:e};k(n.message),m(n)},onClose:function(){P(!1),p()}},d.RmPaymentEngine.init(t),d.RmPaymentEngine.showPaymentWidget(),[3,5];case 4:return o=s.sent(),a=o instanceof Error?o.message:"Unknown error occurred",k(a),P(!1),m({status:"error",message:a}),[3,5];case 5:return[2]}})})},[n,C,L,l,m,p,d]),D=a(function(e){return c(void 0,void 0,void 0,function(){var r,t;return s(this,function(o){return h(d)?(r=v(n)).length>0?(k("Configuration errors: ".concat(r.join(", "))),m({status:"error",message:"Configuration errors: ".concat(r.join(", "))}),[2,Promise.resolve()]):(t=f(e)).length>0?(k("Payment data errors: ".concat(t.join(", "))),m({status:"error",message:"Payment data errors: ".concat(t.join(", "))}),[2,Promise.resolve()]):[2,Z(e)]:(k("Invalid environment for payment processing"),m({status:"error",message:"Invalid environment for payment processing"}),[2,Promise.resolve()])})})},[d,n,Z,m]);return{initiatePayment:D,isLoading:I,error:R,isScriptLoaded:C}},I=function(r){var t=r.config,o=r.paymentData,a=r.environment,u=void 0===a?"demo":a,l=r.onSuccess,m=r.onError,p=r.onClose,d=r.disabled,f=void 0!==d&&d,v=r.className,h=void 0===v?"":v,g=r.children,b=N({config:t,environment:u,onSuccess:l,onError:m,onClose:p}),w=b.initiatePayment,I=b.isLoading,P=b.error,E=b.isScriptLoaded,R=I?"Processing...":E?g||"Pay Now":"Loading...",S=f||I||!E||!!P;return e("div",{className:"remita-payment-container ".concat(h),children:[n("button",{type:"button",onClick:function(){return c(void 0,void 0,void 0,function(){var e;return s(this,function(n){switch(n.label){case 0:return f||I||!E?[2]:(e=i(i({},o),{transactionId:o.transactionId||y()}),[4,w(e)]);case 1:return n.sent(),[2]}})})},disabled:S,className:"remita-payment-button","aria-label":"Initiate Remita payment",children:R}),P&&n("div",{className:"remita-payment-error",role:"alert",children:e("span",{children:["Payment Error: ",P]})})]})};export{I as RemitaPayment,y as generateTransactionRef,g as maskSensitiveData,d as sanitizeString,N as useRemitaPayment,m as validateAmount,u as validateEmail,h as validateEnvironment,f as validatePaymentRequest,l as validatePhoneNumber,v as validateRemitaConfig,p as validateTransactionId};
//# sourceMappingURL=index.esm.js.map
