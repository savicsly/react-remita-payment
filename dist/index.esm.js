import{jsxs as e,jsx as n}from"react/jsx-runtime";import{useState as t,useEffect as r,useCallback as o}from"react";var a=function(){return a=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},a.apply(this,arguments)};function i(e,n,t,r){return new(t||(t=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(i,c)}s((r=r.apply(e,n||[])).next())})}function c(e,n){var t,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(t=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=n.call(e,a)}catch(e){c=[6,e],r=0}finally{t=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}"function"==typeof SuppressedError&&SuppressedError;var s={demo:"https://remitademo.net/payment/v1/remita-pay-inline.bundle.js",live:"https://login.remita.net/payment/v1/remita-pay-inline.bundle.js"},u=null,l=function(){return"undefined"!=typeof window&&!!window.RmPaymentEngine&&"function"==typeof window.RmPaymentEngine.showPaymentWidget},m=function(e){return u||(u=new Promise(function(n,t){if("undefined"==typeof window||"undefined"==typeof document)return t(new Error("Remita script can only be loaded in a browser environment."));if(l())return console.log("Remita engine already initialized."),n(window.RmPaymentEngine);var r=s[e],o="remita-script-".concat(e),a=document.getElementById(o);a&&(console.log("Removing existing Remita script tag."),a.remove());var i=document.createElement("script");i.id=o,i.src=r,i.async=!0,i.defer=!0,i.setAttribute("crossorigin","anonymous");var c=setTimeout(function(){t(new Error("Remita script loading timed out after 30 seconds. Please check your network connection."))},3e4);window.remitaAsyncInit=function(){clearTimeout(c),l()?(console.log("Remita engine initialized via remitaAsyncInit callback."),n(window.RmPaymentEngine)):t(new Error("remitaAsyncInit was called, but Remita engine is not available."))},i.onerror=function(e){clearTimeout(c),u=null,t(new Error("Failed to load Remita script: ".concat(e instanceof Event?"Network error":e)))},console.log("Loading Remita script for ".concat(e," environment.")),document.head.appendChild(i)}))},d=function(e){return/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(e)},p=function(e){return/^(\+234|234|0)[789][01]\d{8}$/.test(e.replace(/\s+/g,""))},f=function(e){if("string"==typeof e){var n=parseFloat(e);if(isNaN(n))return!1;e=n}return e>0&&Number.isFinite(e)},y=function(e){return/^[a-zA-Z0-9-_]{6,50}$/.test(e)},g=function(e){return e.replace(/[<>]/g,"").replace(/[&]/g,"&amp;").replace(/['"]/g,"").trim()},v=function(e){var n=[];return void 0===e.amount||null===e.amount?n.push("Amount is required"):f(e.amount)||n.push("Invalid amount. Amount must be a positive number"),e.email&&d(e.email)||n.push("Invalid email address format"),(!e.firstName||e.firstName.trim().length<2)&&n.push("First name must be at least 2 characters long"),(!e.lastName||e.lastName.trim().length<2)&&n.push("Last name must be at least 2 characters long"),e.transactionId&&y(e.transactionId)||n.push("Invalid transaction ID. Must be 6-50 alphanumeric characters"),e.phoneNumber&&!p(e.phoneNumber)&&n.push("Invalid phone number format"),n},h=function(e){var n=[];return e.publicKey&&0!==e.publicKey.trim().length||n.push("Public key is required"),e.serviceTypeId&&0!==e.serviceTypeId.trim().length||n.push("Service type ID is required"),e.currency&&!["NGN","USD","GBP","EUR"].includes(e.currency)&&n.push("Invalid currency. Supported currencies: NGN, USD, GBP, EUR"),n},w=function(e){void 0===e&&(e="RMT");var n=Date.now().toString(36),t=Math.random().toString(36).substr(2,9);return"".concat(e,"_").concat(n,"_").concat(t).toUpperCase()},b=function(){return!0},N=function(e){if(!e||"object"!=typeof e)return{};var n=a({},e);if("string"==typeof n.email){var t=n.email.split("@"),r=t[0],o=t[1];n.email="".concat(r.charAt(0),"***@").concat(o)}return"string"==typeof n.phoneNumber&&(n.phoneNumber="***".concat(n.phoneNumber.slice(-4))),"string"==typeof n.publicKey&&(n.publicKey="".concat(n.publicKey.slice(0,4),"***").concat(n.publicKey.slice(-4))),n},P=function(e){var n=e.config,a=e.environment,s=void 0===a?"demo":a,u=e.onSuccess,l=e.onError,d=e.onClose,p=t(!1),f=p[0],y=p[1],g=t(null),w=g[0],b=g[1],N=t(!1),P=N[0],R=N[1],E=t(!1),I=E[0],A=E[1];r(function(){A(!0)},[]),r(function(){if(I){var e=h(n);e.length>0&&b("Configuration errors: ".concat(e.join(", ")))}},[I,n]);var S=o(function(e){return i(void 0,void 0,void 0,function(){var t,r,o,a,i,p,f,g,h;return c(this,function(c){switch(c.label){case 0:if("undefined"==typeof window||!I)return console.error("Payment initiation called in a non-browser environment."),[2];y(!0),b(null),c.label=1;case 1:if(c.trys.push([1,3,,4]),(t=v(e)).length>0)throw new Error("Payment data errors: ".concat(t.join(", ")));return[4,m(s)];case 2:if(c.sent(),R(!0),"function"!=typeof(null===(i=window.RmPaymentEngine)||void 0===i?void 0:i.init)||"function"!=typeof(null===(p=window.RmPaymentEngine)||void 0===p?void 0:p.showPaymentWidget))throw new Error("Remita Payment Engine failed to initialize correctly.");return console.log("Remita engine is ready."),r={key:n.publicKey,processRrr:!0,transactionId:null!==(f=e.transactionId)&&void 0!==f?f:"TXN_".concat(Date.now()),amount:e.amount,currency:n.currency||"NGN",customerId:e.email,firstName:e.firstName,lastName:e.lastName,email:e.email,phoneNumber:null!==(g=e.phoneNumber)&&void 0!==g?g:"",narration:e.narration||"Payment for ".concat(null!==(h=e.transactionId)&&void 0!==h?h:"transaction"),onSuccess:function(t){var r;y(!1);var o={status:"success",transactionId:null!==(r=e.transactionId)&&void 0!==r?r:"",paymentReference:t.paymentReference||t.transactionId,message:t.message||"Payment successful",amount:e.amount,currency:n.currency||"NGN",channel:t.channel,gatewayResponseCode:t.gatewayResponseCode,gatewayResponseMessage:t.gatewayResponseMessage};u(o)},onError:function(e){y(!1);var n={status:"error",message:e.message||"Payment failed",code:e.code,details:e};b(n.message),l(n)},onClose:function(){y(!1),d()}},console.log("Initializing payment widget..."),window.RmPaymentEngine.init(r),console.log("Showing payment widget..."),window.RmPaymentEngine.showPaymentWidget(),[3,4];case 3:return o=c.sent(),a=o instanceof Error?o.message:"An unknown error occurred.",b(a),y(!1),l({status:"error",message:a}),[3,4];case 4:return[2]}})})},[n,s,I,u,l,d]);return{initiatePayment:S,isLoading:f,error:w,isScriptLoaded:P}},R=function(o){var s=o.config,u=o.paymentData,l=o.environment,m=void 0===l?"demo":l,d=o.onSuccess,p=o.onError,f=o.onClose,y=o.disabled,g=void 0!==y&&y,v=o.className,h=void 0===v?"":v,b=o.children,N=t(!1),R=N[0],E=N[1];r(function(){E(!0)},[]);var I=P({config:s,environment:m,onSuccess:d,onError:p,onClose:f}),A=I.initiatePayment,S=I.isLoading,k=I.error,z=R?S?"Processing Payment...":b||"Pay Now":"Loading...",j=!R||S||g||!!k;return e("div",{className:"remita-payment-container ".concat(h),children:[n("button",{type:"button",onClick:function(){return i(void 0,void 0,void 0,function(){var e,n,t;return c(this,function(r){switch(r.label){case 0:if(!R||S||g)return[2];if(e=a(a({},u),{transactionId:u.transactionId||w()}),o=u.amount,(i="string"==typeof o?parseFloat(o):o)>1e7&&Number.isFinite(i)&&(n="number"==typeof u.amount?u.amount.toLocaleString(void 0,{maximumFractionDigits:2}):u.amount,!window.confirm("You're about to make a high-value payment of ".concat(n,". Are you sure you want to proceed?"))))return[2];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,A(e)];case 2:return r.sent(),[3,4];case 3:return t=r.sent(),console.error("Payment initiation failed:",t),[3,4];case 4:return[2]}var o,i})})},disabled:j,className:"remita-payment-button".concat(j?" remita-payment-button-disabled":""),"aria-label":"Initiate Remita payment",style:{cursor:j?"not-allowed":"pointer",opacity:j?.7:1},"data-testid":"remita-payment-button",children:z}),k&&R&&n("div",{className:"remita-payment-error",role:"alert",children:e("span",{children:["Payment Error: ",k]})})]})};export{R as RemitaPayment,w as generateTransactionRef,N as maskSensitiveData,g as sanitizeString,P as useRemitaPayment,f as validateAmount,d as validateEmail,b as validateEnvironment,v as validatePaymentRequest,p as validatePhoneNumber,h as validateRemitaConfig,y as validateTransactionId};
//# sourceMappingURL=index.esm.js.map
