import{jsxs as e,jsx as n}from"react/jsx-runtime";import t,{useState as r,useRef as o,useCallback as i,useEffect as a}from"react";var c=function(){return c=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},c.apply(this,arguments)};function u(e,n,t,r){return new(t||(t=Promise))(function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function c(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(a,c)}u((r=r.apply(e,n||[])).next())})}function s(e,n){var t,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=c(0),a.throw=c(1),a.return=c(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(c){return function(u){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=n.call(e,i)}catch(e){c=[6,e],r=0}finally{t=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}}"function"==typeof SuppressedError&&SuppressedError;var d=function(e){return/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(e)},l=function(e){return/^(\+234|234|0)[789][01]\d{8}$/.test(e.replace(/\s+/g,""))},m=function(e){return e>0&&e<=1e7&&Number.isFinite(e)},f=function(e){return/^[a-zA-Z0-9-_]{6,50}$/.test(e)},p=function(e){return e.replace(/[<>]/g,"").replace(/[&]/g,"&amp;").replace(/['"]/g,"").trim()},y=function(e){var n=[];return e.amount&&m(e.amount)||n.push("Invalid amount. Amount must be a positive number and not exceed 10,000,000"),e.email&&d(e.email)||n.push("Invalid email address format"),(!e.firstName||e.firstName.trim().length<2)&&n.push("First name must be at least 2 characters long"),(!e.lastName||e.lastName.trim().length<2)&&n.push("Last name must be at least 2 characters long"),e.transactionId&&f(e.transactionId)||n.push("Invalid transaction ID. Must be 6-50 alphanumeric characters"),e.phoneNumber&&!l(e.phoneNumber)&&n.push("Invalid phone number format"),n},v=function(e){var n=[];return e.publicKey&&0!==e.publicKey.trim().length||n.push("Public key is required"),e.serviceTypeId&&0!==e.serviceTypeId.trim().length||n.push("Service type ID is required"),e.currency&&!["NGN","USD","GBP","EUR"].includes(e.currency)&&n.push("Invalid currency. Supported currencies: NGN, USD, GBP, EUR"),n},h=function(e){void 0===e&&(e="RMT");var n=Date.now().toString(36),t=Math.random().toString(36).substr(2,9);return"".concat(e,"_").concat(n,"_").concat(t).toUpperCase()},w=function(e){return"undefined"==typeof window||"undefined"==typeof document||(void 0===e&&(e=window),e&&"object"==typeof e&&e.location?("production"===process.env.NODE_ENV&&"https:"!==e.location.protocol&&console.warn("RemitaPayment: HTTPS is recommended for production payment processing"),!0):(console.warn("RemitaPayment: Unusual browser environment detected"),!0))},b=function(e){if(!e||"object"!=typeof e)return{};var n=c({},e);if("string"==typeof n.email){var t=n.email.split("@"),r=t[0],o=t[1];n.email="".concat(r.charAt(0),"***@").concat(o)}return"string"==typeof n.phoneNumber&&(n.phoneNumber="***".concat(n.phoneNumber.slice(-4))),"string"==typeof n.publicKey&&(n.publicKey="".concat(n.publicKey.slice(0,4),"***").concat(n.publicKey.slice(-4))),n},g={demo:"https://remitademo.net/payment/v1/remita-pay-inline.bundle.js",live:"https://login.remita.net/payment/v1/remita-pay-inline.bundle.js"};function P(e){var n,t;return!!e&&"object"==typeof e&&"RmPaymentEngine"in e&&"function"==typeof(null===(n=e.RmPaymentEngine)||void 0===n?void 0:n.init)&&"function"==typeof(null===(t=e.RmPaymentEngine)||void 0===t?void 0:t.showPaymentWidget)}var E=function(e){var n=e.config,t=e.environment,c=void 0===t?"demo":t,d=e.onSuccess,l=e.onError,m=e.onClose,f=e.win,p=void 0===f?"undefined"!=typeof window?window:void 0:f,h=r(!1),b=h[0],E=h[1],N=r(null),R=N[0],I=N[1],S=r(!1),A=S[0],j=S[1],C=r(!1),L=C[0],T=C[1],D=o(!1),F=i(function(e){L&&I(e)},[L]);a(function(){if("undefined"!=typeof window&&"undefined"!=typeof document){if("complete"!==document.readyState&&"interactive"!==document.readyState){var e=function(){D.current=!0,setTimeout(function(){return T(!0)},20)};return window.addEventListener("DOMContentLoaded",e),function(){return window.removeEventListener("DOMContentLoaded",e)}}D.current=!0;var n=setTimeout(function(){T(!0)},20);return function(){return clearTimeout(n)}}},[]),a(function(){if(L){var e=null,t=v(n);t.length>0&&(e="Configuration errors: ".concat(t.join(", "))),e&&F(e)}},[L,n,F]);var k=o(null),x=o([]),z=i(function(){return new Promise(function(e,n){var t="undefined"!=typeof window&&"undefined"!=typeof document?p||window:void 0;if(!t)return console.log("RemitaPayment: SSR environment detected, deferring script loading to client"),void e();if(P(t)&&A)e();else{if(!t.document||!t.document.body)return console.warn("RemitaPayment: Document body not available yet, deferring script load"),void setTimeout(function(){z().then(e).catch(n)},50);try{var r=g[c],o=t.document.querySelector('script[src="'.concat(r,'"]'));if(o){if(o.hasAttribute("data-loaded")||P(t))return j(!0),void e();var i=function(){o.setAttribute("data-loaded","true"),j(!0),e(),u()},a=function(){F("Failed to load Remita payment script"),n(new Error("Failed to load Remita payment script")),u()},u=function(){o.removeEventListener("load",i),o.removeEventListener("error",a)};return o.addEventListener("load",i),void o.addEventListener("error",a)}var s=t.document.createElement("script");s.src=r,s.async=!0,s.defer=!0,s.id="remita-payment-script-".concat(c),s.onload=function(){s.setAttribute("data-loaded","true"),j(!0),k.current=s,e()},s.onerror=function(){F("Failed to load Remita payment script"),n(new Error("Failed to load Remita payment script"))},s.setAttribute("crossorigin","anonymous"),s.setAttribute("referrerpolicy","strict-origin-when-cross-origin"),s.setAttribute("data-remita","payment-script"),t.document.body.appendChild(s)}catch(e){console.error("RemitaPayment: Error loading script:",e),F("Failed to load Remita payment script"),n(new Error("Failed to load Remita payment script"))}}})},[c,A,p,F]);a(function(){return function(){k.current&&k.current.parentNode&&k.current.parentNode.removeChild(k.current)}},[]);var O=i(function(e){return u(void 0,void 0,void 0,function(){var t,r,o,i,a,c,u,f;return s(this,function(s){switch(s.label){case 0:if(!(t=p||("undefined"!=typeof window?window:void 0)))return F("Payment can only be initiated in a browser environment"),[2];s.label=1;case 1:if(s.trys.push([1,4,,5]),E(!0),F(null),x.current.length>0)throw new Error("Configuration errors: ".concat(x.current.join(", ")));if((r=y(e)).length>0)throw new Error("Payment data errors: ".concat(r.join(", ")));return A?[3,3]:[4,z()];case 2:s.sent(),s.label=3;case 3:if(!t||!P(t))throw new Error("Remita payment engine not available");return o={key:n.publicKey,processRrr:!0,transactionId:null!==(c=e.transactionId)&&void 0!==c?c:"",amount:e.amount,currency:n.currency||"NGN",customerId:e.email,firstName:e.firstName,lastName:e.lastName,email:e.email,phoneNumber:null!==(u=e.phoneNumber)&&void 0!==u?u:"",narration:e.narration||"Payment for ".concat(null!==(f=e.transactionId)&&void 0!==f?f:""),onSuccess:function(t){var r;E(!1);var o={status:"success",transactionId:null!==(r=e.transactionId)&&void 0!==r?r:"",paymentReference:t.paymentReference||t.transactionId,message:t.message||"Payment successful",amount:e.amount,currency:n.currency||"NGN",channel:t.channel,gatewayResponseCode:t.gatewayResponseCode,gatewayResponseMessage:t.gatewayResponseMessage};d(o)},onError:function(e){E(!1);var n={status:"error",message:e.message||"Payment failed",code:e.code,details:e};F(n.message),l(n)},onClose:function(){E(!1),m()}},t.RmPaymentEngine.init(o),t.RmPaymentEngine.showPaymentWidget(),[3,5];case 4:return i=s.sent(),a=i instanceof Error?i.message:"Unknown error occurred",F(a),E(!1),l({status:"error",message:a}),[3,5];case 5:return[2]}})})},[n,A,z,F,d,l,m,E,p]);return{initiatePayment:i(function(e){return u(void 0,void 0,void 0,function(){var t,r,o,i;return s(this,function(a){return t=p||("undefined"!=typeof window?window:void 0),"undefined"==typeof window?[2,Promise.resolve()]:w(t)?(r=v(n)).length>0?(i="Configuration errors: ".concat(r.join(", ")),F(i),l({status:"error",message:i}),[2,Promise.resolve()]):(o=y(e)).length>0?(i="Payment data errors: ".concat(o.join(", ")),F(i),l({status:"error",message:i}),[2,Promise.resolve()]):[2,O(e)]:(F(i="Payment can only be initiated in a browser environment"),l({status:"error",message:i}),[2,Promise.resolve()])})})},[p,n,O,l,F]),isLoading:b,error:R,isScriptLoaded:A}},N=function(o){var i=o.config,a=o.paymentData,d=o.environment,l=void 0===d?"demo":d,m=o.onSuccess,f=o.onError,p=o.onClose,y=o.disabled,v=void 0!==y&&y,w=o.className,b=void 0===w?"":w,g=o.children,P=r(!1),N=P[0],R=P[1],I=r(!1),S=I[0],A=I[1],j=t.useRef(!1);t.useEffect(function(){if("undefined"!=typeof window&&"undefined"!=typeof document){R(!0);var e=requestAnimationFrame(function(){setTimeout(function(){j.current=!0,A(!0)},10)});return function(){return cancelAnimationFrame(e)}}},[]);var C=E({config:i,environment:l,onSuccess:m,onError:f,onClose:p,win:N?window:void 0}),L=C.initiatePayment,T=C.isLoading,D=C.error,F=C.isScriptLoaded,k=T?"Processing...":S&&F?g||"Pay Now":"Loading...",x=v||T||!F||!S||!N||!!D;return e("div",{className:"remita-payment-container ".concat(b),children:[n("button",{type:"button",onClick:function(){return u(void 0,void 0,void 0,function(){var e;return s(this,function(n){switch(n.label){case 0:return!v&&!T&&F&&S&&N&&j.current?(e=c(c({},a),{transactionId:a.transactionId||h()}),[4,L(e)]):[2];case 1:return n.sent(),[2]}})})},disabled:x,className:"remita-payment-button","aria-label":"Initiate Remita payment",style:{cursor:x?"not-allowed":"pointer",opacity:x?.7:1},children:k}),D&&S&&n("div",{className:"remita-payment-error",role:"alert",children:e("span",{children:["Payment Error: ",D]})})]})};export{N as RemitaPayment,h as generateTransactionRef,b as maskSensitiveData,p as sanitizeString,E as useRemitaPayment,m as validateAmount,d as validateEmail,w as validateEnvironment,y as validatePaymentRequest,l as validatePhoneNumber,v as validateRemitaConfig,f as validateTransactionId};
//# sourceMappingURL=index.esm.js.map
